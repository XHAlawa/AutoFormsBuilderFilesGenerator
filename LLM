# LLM Guidance for AutoFormsBuilderFilesGenerator

This file is intended for Large Language Models (LLMs) and AI coding assistants that interact with this repository. It summarizes the project, key conventions, and constraints so automated tools can provide correct, non-destructive help.

## 1. Project purpose

This project is a **code generator** for Angular reactive forms based on an **OpenAPI/Swagger schema**. It works together with `ng-openapi-gen`:

- `ng-openapi-gen` generates Angular API services and models from `swagger.json`.
- This generator (`angular-formsbuilder-gen`) generates **FormBuilder services**, helpers, validation utilities, and Angular UI helpers for forms, based on the same schema and config file.

Target Angular version: **12+** (with optional support for **Angular Signals** features in newer Angular versions).

## 2. Core runtime artifacts generated

Given a valid `swagger.json` configuration, the generator emits TypeScript files into the `formsOutput` folder, including:

- One `*FormBuilder` service **per model** in the OpenAPI schema.
- Helper/runtime files (names are important and referenced by the templates):
  - `FormsHelpers.ts`
  - `CustomeValidators.ts`
  - `ValidationManager.ts`
  - `ValidationUiHelpers.ts`
  - `ShowForErrorDirective.ts`
  - `IFormBuilder.ts`
  - `DateHelper.ts`
  - `EnumHelper.ts`
  - `FormsExtensions.d.ts` (declaration file augmenting Angular `FormGroup` with `showValidationErrors`)
  - `AutoFormsBuilderModule.ts` (NgModule that wraps generated validation UI helpers)

These filenames are consumed by the templates and by `templateGenerator.ts`. Changing them has cascading effects.

## 3. Configuration source (swagger.json / IParsedConfig)

The generator reads a JSON configuration file (commonly `swagger.json`). The parsed structure is represented by `IParsedConfig` in `src/interfaces/IParsedConfig.ts`. Key properties:

- `input`: URL of the OpenAPI JSON schema.
- `schemeFile`: Local path to the schema JSON (takes precedence if present).
- `modelsPath`: Path to models generated by `ng-openapi-gen`.
- `formsOutput`: Target folder for generated form files.
- `useEnumValuesAsString?`: Whether enum fields use string values.
- `useSignalFormTemplates?`: Whether to use Signals-based templates instead of classic reactive templates.
- Generation toggles:
  - `generateFormsHelpers?`
  - `generateCustomValidators?`
  - `generateValidationManager?`
  - `generateShowForErrorDirective?`
  - `generateIFormBuilder?`
  - `generateDateHelper?`
  - `generateEnumHelper?`
  - `generateValidationUiHelpers?`
- Template customization:
  - `customFormTemplatePath?`
  - `customSignalFormTemplatePath?`
  - `validationErrorTemplatePath?` (if present)
- Housekeeping & filtering:
  - `cleanupUnusedFiles?`: remove obsolete generated form files.
  - `includeModels?: string[]`: whitelist of model names.
  - `excludeModels?: string[]`: blacklist of model names.
  - `generateValidationMessagesJson?`: emit `validation-messages.en.json` for i18n.

Any AI changes to config-related code must respect backward-compatibility of these fields.

## 4. Template system and generation flow

Key files used by the generator:

- `src/templateGenerator.ts` – main orchestration:
  - Loads `IParsedConfig` and root `components.schemas` from the OpenAPI document.
  - Applies `includeModels` / `excludeModels` to decide which models to process.
  - Uses `templateBuilder` to generate a `*FormBuilder` service per model.
  - Writes helper TS files listed above based on generation flags.
  - Optionally cleans up orphan `.ts` files under `formsOutput` if `cleanupUnusedFiles` is true.
  - Generates a `validation-messages.en.json` file when `generateValidationMessagesJson` is enabled.

- `src/Builders/*.ts` – type-specific builders (e.g. `ArrayType`, `PermitiveType`, `BasedOnEnumType`).
- `src/templates/*.ts` – each exports a `getTemplate()` method returning a **string of TypeScript code**.

LLM edits in these areas must preserve:

- Proper string escaping inside template literals.
- No introduction of comments into **generated output** (see next section).

## 5. Critical conventions and constraints

1. **No comments in generated TypeScript output** for user-facing files (per user requirement).
   - Template files `src/templates/*.ts` may contain comments inside the generator code itself, but when they build template strings, those strings **should not** include comments.

2. **Filnames and public APIs are part of the contract**:
   - FormBuilder services: `ModelNameFormBuilder` naming convention via `helpers.normalizeToFormBuilderName(name)`.
   - Helpers and validators file names (see section 2) should remain stable.

3. **FormBuilder services behavior**:
   - Expose `buildForm(model?: T)` that returns a `FormGroup`.
   - Provide strongly-typed control getters for better IntelliSense.
   - Handle arrays via generated helper methods (ArrayType + arrayMethodsTemplate) with proper typing (`FormArray<FormGroup>` for object arrays, `FormArray<FormControl>` for primitive/enum arrays).

4. **Validation ecosystem**:
   - `ValidationManager` offers typed error keys, default messages, a pluggable `ValidationMessageResolver`, and a global error HTML template API.
   - CSS config is centralized in `ValidationManager.cssConfig` (defaults use Bootstrap 5 classes `is-invalid` and `invalid-feedback`).

5. **Angular UI helpers**:
   - `ValidationUiHelpers.ts` declares:
     - `ValidationErrorPipe` / `ValidationErrorsPipe`
     - `ValidationErrorsComponent`
     - `AfbAutoErrorsDirective` (adds `form.showValidationErrors` and emits HTML errors)
     - `ForFormArrayDirective` (structural `*ForFormArray` helper).

6. **AutoFormsBuilderModule**:
   - `AutoFormsBuilderModule.ts` is an NgModule that declares/exports all UI helpers.
   - Configuration is passed via `AutoFormsBuilderModule.init(config: AutoFormsBuilderConfig)` in the root module.
   - Effective runtime configuration is available at `AutoFormsBuilderModule.Configs`.

## 6. Safe change guidelines for LLMs

When modifying this repository:

- Prefer **additive** changes over breaking ones. If you must change behavior, keep public APIs and filenames stable.
- When editing templates, verify that:
  - The generated code still compiles as TypeScript.
  - Template literals are correctly escaped (especially backticks, backslashes, and `${}` interpolations).
  - No comments are emitted into generated files unless the user explicitly changes that requirement.
- For `FormArray` handling:
  - Maintain strong typing in helpers (`FormArray<FormGroup>` or `FormArray<FormControl>`).
  - Ensure patch logic clears arrays before re-adding items to avoid duplicates.
- For validation:
  - Do not remove or weaken `ValidationManager` features (typed keys, resolver hook, global template, CSS config).
  - Keep CSS defaults aligned with Bootstrap 5.
- For CLI (`src/index.ts`):
  - Preserve support for `--help`, `--customize`, and `init`.
  - Keep backward-compatible argument behavior unless the user requests a breaking change.

## 7. Roadmap note for LLMs

The README includes a public roadmap item stating that **future versions** will support optional internal creation of TypeScript models directly from the OpenAPI schema (without relying on `ng-openapi-gen`). This is not implemented yet; LLMs should not assume that behavior exists.

If implementing this in the future, it must:

- Keep existing `modelsPath`-based flows working.
- Likely introduce a new config flag rather than repurposing existing ones.
